<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Premium Expense Manager</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{font-family:Poppins, sans-serif;background:#f5f8ff;margin:0;}
.container{max-width:1100px;margin:auto;padding:20px;}
.card{background:white;padding:20px;border-radius:15px;margin-top:15px;
      box-shadow:0 0 20px rgba(0,0,0,0.15);}
h2{text-align:center;color:#007bff;}

input,button{padding:12px;border-radius:10px;width:100%;border:1px solid #ccc;margin:5px 0;}
button{background:#007bff;color:white;font-weight:bold;cursor:pointer;}
button:hover{background:#0056b3;}

#logoutBtn{background:#ff1744;}
table{width:100%;border-collapse:collapse;margin-top:10px;}
th,td{border:1px solid #ccc;padding:10px;text-align:center;}
th{background:#007bff;color:white;}

.progress{background:#ddd;height:12px;border-radius:10px;margin-top:10px;}
.progress-bar{height:12px;border-radius:10px;background:#00c853;width:0%;}

.summary{display:flex;gap:15px;}
.box{flex:1;background:#e3f2fd;padding:15px;text-align:center;border-radius:10px;font-weight:bold;}
</style>
</head>

<body>
<div class="container">

<h2>ðŸ’¸ Premium Expense Dashboard</h2>

<div class="card">
<h3>Create Profile</h3>
<input id="newUser" placeholder="Name">
<input id="newPass" maxlength="16" placeholder="16 character password">
<button onclick="createProfile()">Create Account</button>
</div>

<div class="card">
<h3>Search User (View Only)</h3>
<input id="searchUser" placeholder="Search user profile">
<button onclick="viewProfile()">Search</button>
</div>

<div class="card">
<h3>Login</h3>
<input id="loginUser" placeholder="Username">
<input id="loginPass" type="password" placeholder="Password">
<button onclick="login()">Login</button>
<div id="loggedUser" style="text-align:center;font-weight:bold;margin:10px;"></div>
</div>

<div class="card">
<h3>Set Monthly Budget (Only when logged in)</h3>
<input id="budgetAmount" type="number" placeholder="Budget Amount">
<button onclick="saveBudget()">Save Budget</button>
<div class="progress"><div id="progressBar" class="progress-bar"></div></div>
<p id="budgetText"></p>
</div>

<div class="card">
<h3>Add Expense</h3>
<input id="item" placeholder="Item name">
<input id="amount" type="number" placeholder="Amount">
<input id="date" type="date">
<input id="category" placeholder="Category">
<button onclick="addExpense()">Add Expense</button>
<button id="logoutBtn" onclick="logout()">Logout</button>
</div>

<div class="summary">
<div class="box" id="totalSpent">Total Spent: Rs 0</div>
<div class="box" id="totalItems">Total Items: 0</div>
<div class="box" id="remainingBudget">Remaining: Rs 0</div>
</div>

<div class="card">
<canvas id="chartCanvas"></canvas>
</div>

<div class="card">
<table>
<thead>
<tr>
<th>Item</th>
<th>Amount</th>
<th>Date</th>
<th>Category</th>
<th>Save</th>
<th>Delete</th>
</tr>
</thead>
<tbody id="expenseTable"></tbody>
</table>
</div>
</div>

<script>
let users = JSON.parse(localStorage.getItem("users")) || [];
let expenses = JSON.parse(localStorage.getItem("expenses")) || [];
let budgets = JSON.parse(localStorage.getItem("budgets")) || {};
let currentUser = null;
let chart;

// Save to memory
function save() {
    localStorage.setItem("users", JSON.stringify(users));
    localStorage.setItem("expenses", JSON.stringify(expenses));
    localStorage.setItem("budgets", JSON.stringify(budgets));
}

// Create user
function createProfile() {
    const n = newUser.value.trim(), p = newPass.value.trim();
    if(!n || p.length !== 16) return alert("Enter valid name and 16 character password!");
    if(users.some(u=>u.name===n)) return alert("User already exists!");
    users.push({name:n, pass:p});
    save();
    alert("Profile Created Successfully!");
}

// Search
function viewProfile() {
    currentUser = null;
    updateTable(searchUser.value.trim());
    loggedUser.innerText = "Viewing only: " + searchUser.value.trim();
}

// Login
function login() {
    const name = loginUser.value.trim(), pass = loginPass.value.trim();
    if(!users.find(u => u.name===name && u.pass===pass)) return alert("Wrong login");
    currentUser = name;
    loggedUser.innerText = "Logged in as: " + currentUser;
    updateTable(currentUser);
    updateBudgetUI();
}

// Logout
function logout() {
    currentUser = null;
    loggedUser.innerText = "Logged out";
    updateTable("");
    updateBudgetUI();
}

// Save budget
function saveBudget() {
    if(!currentUser) return alert("Login first");
    budgets[currentUser] = Number(budgetAmount.value);
    save();
    updateBudgetUI();
}

// Add expense
function addExpense() {
    if(!currentUser) return alert("Login first");
    expenses.push({
        user: currentUser,
        item: item.value,
        amount: Number(amount.value),
        date: date.value,
        category: category.value
    });
    save();
    updateTable(currentUser);
}

// Update table
function updateTable(name) {
    const t = document.getElementById("expenseTable");
    t.innerHTML = "";
    let total = 0, cat = {};
    expenses.forEach((e,i)=>{
        if(e.user === name) {
            total += Number(e.amount);
            cat[e.category] = (cat[e.category] || 0) + Number(e.amount);

            t.innerHTML += `<tr>
                <td><input value="${e.item}" onchange="expenses[${i}].item=this.value"></td>
                <td><input type="number" value="${e.amount}" onchange="expenses[${i}].amount=Number(this.value)"></td>
                <td><input type="date" value="${e.date}" onchange="expenses[${i}].date=this.value"></td>
                <td><input value="${e.category}" onchange="expenses[${i}].category=this.value"></td>
                <td><button onclick="saveExpense(${i})">ðŸ’¾ Save</button></td>
                <td><button onclick="deleteExpense(${i})">ðŸ—‘</button></td>
            </tr>`;
        }
    });

    totalSpent.innerText = "Total Spent: Rs " + total;
    totalItems.innerText = "Total Items: " + t.rows.length;
    if(budgets[name]) remainingBudget.innerText = "Remaining: Rs " + (budgets[name]-total);

    updateBudgetBar(total, budgets[name]);
    drawChart(cat);
}

// Save edited expense
function saveExpense(i){
    save();
    updateTable(currentUser);
}

// Delete expense
function deleteExpense(i){
    expenses.splice(i,1);
    save();
    updateTable(currentUser);
}

// Budget bar
function updateBudgetBar(total, limit){
    const bar = document.getElementById("progressBar");
    if(!limit) return bar.style.width = "0%";
    const p = (total/limit)*100;
    bar.style.width = p+"%";
    bar.style.background = p>100?"red":"#00c853";
    budgetText.innerText = `Budget: ${limit} | Used: ${total} | Left: ${limit-total}`;
}

// Chart
function drawChart(data){
    if(chart) chart.destroy();
    chart = new Chart(chartCanvas, {
        type:"pie",
        data: {labels:Object.keys(data), datasets:[{data:Object.values(data)}]}
    });
}

function updateBudgetUI(){
    if(currentUser && budgets[currentUser]) budgetAmount.value = budgets[currentUser];
    else budgetAmount.value = "";
}

updateTable("");
</script>
</body>
</html>
